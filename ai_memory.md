we have a local on device ai. i am using gemma3n model locally. now we have to implement a memory logic 
to our ai so it will be used as conversastional buddy. first we will work on database. kinda of like 
below. also provide me more comprehensive data table once we both confirm then only add the db. 

I suggest three new tables: Conversations, ChatMessages, and Memories. we also should consider token counts for each message to manage the memory effectively. we should have short-term and long-term memory management.


# Memory 
## short term
    - working memory
    - cache
## long term
    - conversational storage
        - data store
        - entity memory
    - episodic memory
        - knowledge base




***

### Updated Database Schema

Here is the revised schema designed for a more intelligent memory architecture.

#### `Users` Table
*No changes here, this table remains the foundation.*

| Column | Type | Description |
| --- | --- | --- |
| `user_id` | `UUID` / `INTEGER` | **Primary Key.** Unique identifier for each user. |
| `username` | `VARCHAR` | A display name for the user. |
| `created_at` | `TIMESTAMP` | When the user profile was created. |

---

#### `Conversations` Table
*Minor enhancements for better context management.*

| Column | Type | Description |
| --- | --- | --- |
| `conversation_id` | `UUID` / `INTEGER` | **Primary Key.** Unique identifier for each chat session. |
| `user_id` | `UUID` / `INTEGER` | **Foreign Key** to the `Users` table. |
| `title` | `VARCHAR` | AI-generated title for the chat. |
| `start_time` | `TIMESTAMP` | When the conversation began. |
| `last_updated` | `TIMESTAMP` | Timestamp of the last message for sorting. |
| `status` | `VARCHAR` | The current state (e.g., 'active', 'archived'). |

---

#### `ShortTermMemory` Table (Previously `ChatMessages`)
*Renamed to better reflect its function as the AI's "working memory" for the current context.*

| Column | Type | Description |
| --- | --- | --- |
| `message_id` | `UUID` / `INTEGER` | **Primary Key.** |
| `conversation_id` | `UUID` / `INTEGER` | **Foreign Key** to `Conversations`. |
| `message_order` | `INTEGER` | The sequence of the message in the conversation. |
| `sender` | `VARCHAR` | 'user', 'ai', or 'system' (for memory retrieval notes). |
| `content_text` | `TEXT` | The raw text of the message. |
| `token_count` | `INTEGER` | Token count for managing the context window. |
| `timestamp` | `TIMESTAMP` | Exact time the message was created. |

---

#### `LongTermMemory` Table (Previously `Memories`)
*This is the most significant evolution, turning it into a structured, searchable knowledge base.*

| Column | Type | Description |
| --- | --- | --- |
| `memory_id` | `UUID` / `INTEGER` | **Primary Key.** |
| `user_id` | `UUID` / `INTEGER` | **Foreign Key** to `Users`. |
| `memory_text` | `TEXT` | The core piece of information (e.g., "User's favorite city is Kyoto"). |
| `embedding` | `VECTOR` | **Crucial for search.** The vector embedding of `memory_text`. |
| `memory_type` | `VARCHAR` | Type of memory: **'fact'** (a stated detail), **'preference'** (user's taste), **'goal'** (something the user wants to do), or **'synthesized'** (an insight generated by the AI). |
| `importance_score`| `FLOAT` | A score from 0.0 to 1.0 assigned by the AI indicating the memory's importance. |
| `last_accessed` | `TIMESTAMP` | The last time this memory was retrieved. Used to calculate recency. |
| `created_at` | `TIMESTAMP` | When the memory was created. |

---

#### `Reflections` Table (New)
*This new table is where the AI performs "thinking." It periodically reviews short-term memory to generate higher-level insights that get stored in long-term memory.*

| Column | Type | Description |
| --- | --- | --- |
| `reflection_id` | `UUID` / `INTEGER` | **Primary Key.** |
| `user_id` | `UUID` / `INTEGER` | **Foreign Key** to `Users`. |
| `reflection_text` | `TEXT` | The synthesized insight or question generated by the AI (e.g., "User often mentions hiking in the context of weekend plans, suggesting it's a primary hobby."). |
| `triggering_message_ids` | `JSON` / `TEXT` | A list of `message_id`s from `ShortTermMemory` that prompted this reflection. |
| `created_at` | `TIMESTAMP` | When the reflection was generated. |

This updated structure directly implements the memory architecture from the video:
-   **Sensory Memory:** A user's message entering the `ShortTermMemory` table is the initial sensory input.
-   **Short-Term Memory:** The `ShortTermMemory` table acts as the context window for the active conversation.
-   **Long-Term Memory:** The `LongTermMemory` table is the permanent, searchable knowledge base.
-   **Memory Processing:** The `Reflections` table provides a dedicated space for the AI to process information, turning raw conversation data into meaningful, synthesized memories that are then added to the `LongTermMemory` table with a `memory_type` of 'synthesized'.